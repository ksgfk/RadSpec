using RadSpec.Spectrum;

namespace RadSpec;

public readonly struct SpectraData(double lambda, double value)
{
    public readonly double Lambda = lambda;
    public readonly double Value = value;
}

/**
 * 知乎的文章 https://zhuanlan.zhihu.com/p/24214731
 * 大佬的文章 https://www.fourmilab.ch/documents/specrend
 *
 * 三色刺激理论(tristimulus theory)认为, 所有可见光谱分布可以使用三个标量值准确地表示给人类观察者
 * 因为人眼具有三种类型的感光视锥细胞, 能分别感知红绿蓝三种颜色
 *
 * 色匹配函数(Color Matching Function)是通过实验得出匹配等能光谱中各单色光所需要的红绿蓝三原色色光的数量
 *
 * CIE RGB色彩空间就是一种色匹配函数, CIE XYZ色彩空间在CIE RGB的基础上进行线性变换得出, 将所有分量变换到正值
 *
 * 将 光谱S(\lambda) 乘以 色匹配函数各个分量m_i(\lambda) 得到的值就是颜色:
 * v_i = \int S(\lambda) m_i(\lambda) \mathrm{d}\lambda
 *
 * 从光谱到CIE XYZ色彩空间转换通过公式给出:
 * https://pbr-book.org/4ed/Radiometry,_Spectra,_and_Color/Color#eq:xyz-matching
 * 不同的光谱可能具有非常相似的XYZ值, 这种现象称为同色异谱
 * (究其本质, 我认为原因是从一个无限维度的连续函数中降维到三维导致一些信息丢失了, 大概)
 *
 * 由于色彩空间是向量空间, 它的乘法和矩阵一样不符合交换律, 所以一般要将色彩转换到线性空间运算, 再转换回去
 */
public static class Spectra
{
    public const int LambdaMin = 360;
    public const int LambdaMax = 830;
    public const int SampleCount = 471;

    private static readonly double[] Cie1931XyzLambdas = [
        360, 361, 362, 363, 364,
        365, 366, 367, 368, 369,
        370, 371, 372, 373, 374,
        375, 376, 377, 378, 379,
        380, 381, 382, 383, 384,
        385, 386, 387, 388, 389,
        390, 391, 392, 393, 394,
        395, 396, 397, 398, 399,
        400, 401, 402, 403, 404,
        405, 406, 407, 408, 409,
        410, 411, 412, 413, 414,
        415, 416, 417, 418, 419,
        420, 421, 422, 423, 424,
        425, 426, 427, 428, 429,
        430, 431, 432, 433, 434,
        435, 436, 437, 438, 439,
        440, 441, 442, 443, 444,
        445, 446, 447, 448, 449,
        450, 451, 452, 453, 454,
        455, 456, 457, 458, 459,
        460, 461, 462, 463, 464,
        465, 466, 467, 468, 469,
        470, 471, 472, 473, 474,
        475, 476, 477, 478, 479,
        480, 481, 482, 483, 484,
        485, 486, 487, 488, 489,
        490, 491, 492, 493, 494,
        495, 496, 497, 498, 499,
        500, 501, 502, 503, 504,
        505, 506, 507, 508, 509,
        510, 511, 512, 513, 514,
        515, 516, 517, 518, 519,
        520, 521, 522, 523, 524,
        525, 526, 527, 528, 529,
        530, 531, 532, 533, 534,
        535, 536, 537, 538, 539,
        540, 541, 542, 543, 544,
        545, 546, 547, 548, 549,
        550, 551, 552, 553, 554,
        555, 556, 557, 558, 559,
        560, 561, 562, 563, 564,
        565, 566, 567, 568, 569,
        570, 571, 572, 573, 574,
        575, 576, 577, 578, 579,
        580, 581, 582, 583, 584,
        585, 586, 587, 588, 589,
        590, 591, 592, 593, 594,
        595, 596, 597, 598, 599,
        600, 601, 602, 603, 604,
        605, 606, 607, 608, 609,
        610, 611, 612, 613, 614,
        615, 616, 617, 618, 619,
        620, 621, 622, 623, 624,
        625, 626, 627, 628, 629,
        630, 631, 632, 633, 634,
        635, 636, 637, 638, 639,
        640, 641, 642, 643, 644,
        645, 646, 647, 648, 649,
        650, 651, 652, 653, 654,
        655, 656, 657, 658, 659,
        660, 661, 662, 663, 664,
        665, 666, 667, 668, 669,
        670, 671, 672, 673, 674,
        675, 676, 677, 678, 679,
        680, 681, 682, 683, 684,
        685, 686, 687, 688, 689,
        690, 691, 692, 693, 694,
        695, 696, 697, 698, 699,
        700, 701, 702, 703, 704,
        705, 706, 707, 708, 709,
        710, 711, 712, 713, 714,
        715, 716, 717, 718, 719,
        720, 721, 722, 723, 724,
        725, 726, 727, 728, 729,
        730, 731, 732, 733, 734,
        735, 736, 737, 738, 739,
        740, 741, 742, 743, 744,
        745, 746, 747, 748, 749,
        750, 751, 752, 753, 754,
        755, 756, 757, 758, 759,
        760, 761, 762, 763, 764,
        765, 766, 767, 768, 769,
        770, 771, 772, 773, 774,
        775, 776, 777, 778, 779,
        780, 781, 782, 783, 784,
        785, 786, 787, 788, 789,
        790, 791, 792, 793, 794,
        795, 796, 797, 798, 799,
        800, 801, 802, 803, 804,
        805, 806, 807, 808, 809,
        810, 811, 812, 813, 814,
        815, 816, 817, 818, 819,
        820, 821, 822, 823, 824,
        825, 826, 827, 828, 829,
        830];

    // 以下是CIE 1931 XYZ色彩空间的色匹配曲线值
    // 数据来源 https://cie.co.at/datatable/cie-1931-colour-matching-functions-2-degree-observer

    /// <summary>
    /// 预积分Y分量
    /// </summary>
    public static readonly double Cie1931IntegralY;
    private static readonly double[] Cie1931XData = [
        0.0001299, 0.000145847, 0.0001638021, 0.0001840037, 0.0002066902,
        0.0002321, 0.000260728, 0.000293075, 0.000329388, 0.000369914,
        0.0004149, 0.0004641587, 0.000518986, 0.000581854, 0.0006552347,
        0.0007416, 0.0008450296, 0.0009645268, 0.001094949, 0.001231154,
        0.001368, 0.00150205, 0.001642328, 0.001802382, 0.001995757,
        0.002236, 0.002535385, 0.002892603, 0.003300829, 0.003753236,
        0.004243, 0.004762389, 0.005330048, 0.005978712, 0.006741117,
        0.00765, 0.008751373, 0.01002888, 0.0114217, 0.01286901,
        0.01431, 0.01570443, 0.01714744, 0.01878122, 0.02074801,
        0.02319, 0.02620736, 0.02978248, 0.03388092, 0.03846824,
        0.04351, 0.0489956, 0.0550226, 0.0617188, 0.069212,
        0.07763, 0.08695811, 0.09717672, 0.1084063, 0.1207672,
        0.13438, 0.1493582, 0.1653957, 0.1819831, 0.198611,
        0.21477, 0.2301868, 0.2448797, 0.2587773, 0.2718079,
        0.2839, 0.2949438, 0.3048965, 0.3137873, 0.3216454,
        0.3285, 0.3343513, 0.3392101, 0.3431213, 0.3461296,
        0.34828, 0.3495999, 0.3501474, 0.350013, 0.349287,
        0.34806, 0.3463733, 0.3442624, 0.3418088, 0.3390941,
        0.3362, 0.3331977, 0.3300411, 0.3266357, 0.3228868,
        0.3187, 0.3140251, 0.308884, 0.3032904, 0.2972579,
        0.2908, 0.2839701, 0.2767214, 0.2689178, 0.2604227,
        0.2511, 0.2408475, 0.2298512, 0.2184072, 0.2068115,
        0.19536, 0.1842136, 0.1733273, 0.1626881, 0.1522833,
        0.1421, 0.1321786, 0.1225696, 0.1132752, 0.1042979,
        0.09564, 0.08729955, 0.07930804, 0.07171776, 0.06458099,
        0.05795001, 0.05186211, 0.04628152, 0.04115088, 0.03641283,
        0.03201, 0.0279172, 0.0241444, 0.020687, 0.0175404,
        0.0147, 0.01216179, 0.00991996, 0.00796724, 0.006296346,
        0.0049, 0.003777173, 0.00294532, 0.00242488, 0.002236293,
        0.0024, 0.00292552, 0.00383656, 0.00517484, 0.00698208,
        0.0093, 0.01214949, 0.01553588, 0.01947752, 0.02399277,
        0.0291, 0.03481485, 0.04112016, 0.04798504, 0.05537861,
        0.06327, 0.07163501, 0.08046224, 0.08973996, 0.09945645,
        0.1096, 0.1201674, 0.1311145, 0.1423679, 0.1538542,
        0.1655, 0.1772571, 0.18914, 0.2011694, 0.2133658,
        0.2257499, 0.2383209, 0.2510668, 0.2639922, 0.2771017,
        0.2904, 0.3038912, 0.3175726, 0.3314384, 0.3454828,
        0.3597, 0.3740839, 0.3886396, 0.4033784, 0.4183115,
        0.4334499, 0.4487953, 0.464336, 0.480064, 0.4959713,
        0.5120501, 0.5282959, 0.5446916, 0.5612094, 0.5778215,
        0.5945, 0.6112209, 0.6279758, 0.6447602, 0.6615697,
        0.6784, 0.6952392, 0.7120586, 0.7288284, 0.7455188,
        0.7621, 0.7785432, 0.7948256, 0.8109264, 0.8268248,
        0.8425, 0.8579325, 0.8730816, 0.8878944, 0.9023181,
        0.9163, 0.9297995, 0.9427984, 0.9552776, 0.9672179,
        0.9786, 0.9893856, 0.9995488, 1.0090892, 1.0180064,
        1.0263, 1.0339827, 1.040986, 1.047188, 1.0524667,
        1.0567, 1.0597944, 1.0617992, 1.0628068, 1.0629096,
        1.0622, 1.0607352, 1.0584436, 1.0552244, 1.0509768,
        1.0456, 1.0390369, 1.0313608, 1.0226662, 1.0130477,
        1.0026, 0.9913675, 0.9793314, 0.9664916, 0.9528479,
        0.9384, 0.923194, 0.907244, 0.890502, 0.87292,
        0.8544499, 0.835084, 0.814946, 0.794186, 0.772954,
        0.7514, 0.7295836, 0.7075888, 0.6856022, 0.6638104,
        0.6424, 0.6215149, 0.6011138, 0.5811052, 0.5613977,
        0.5419, 0.5225995, 0.5035464, 0.4847436, 0.4661939,
        0.4479, 0.4298613, 0.412098, 0.394644, 0.3775333,
        0.3608, 0.3444563, 0.3285168, 0.3130192, 0.2980011,
        0.2835, 0.2695448, 0.2561184, 0.2431896, 0.2307272,
        0.2187, 0.2070971, 0.1959232, 0.1851708, 0.1748323,
        0.1649, 0.1553667, 0.14623, 0.13749, 0.1291467,
        0.1212, 0.1136397, 0.106465, 0.09969044, 0.09333061,
        0.0874, 0.08190096, 0.07680428, 0.07207712, 0.06768664,
        0.0636, 0.05980685, 0.05628216, 0.05297104, 0.04981861,
        0.04677, 0.04378405, 0.04087536, 0.03807264, 0.03540461,
        0.0329, 0.03056419, 0.02838056, 0.02634484, 0.02445275,
        0.0227, 0.02108429, 0.01959988, 0.01823732, 0.01698717,
        0.01584, 0.01479064, 0.01383132, 0.01294868, 0.0121292,
        0.01135916, 0.01062935, 0.009938846, 0.009288422, 0.008678854,
        0.008110916, 0.007582388, 0.007088746, 0.006627313, 0.006195408,
        0.005790346, 0.005409826, 0.005052583, 0.004717512, 0.004403507,
        0.004109457, 0.003833913, 0.003575748, 0.003334342, 0.003109075,
        0.002899327, 0.002704348, 0.00252302, 0.002354168, 0.002196616,
        0.00204919, 0.00191096, 0.001781438, 0.00166011, 0.001546459,
        0.001439971, 0.001340042, 0.001246275, 0.001158471, 0.00107643,
        0.0009999493, 0.0009287358, 0.0008624332, 0.0008007503, 0.000743396,
        0.0006900786, 0.0006405156, 0.0005945021, 0.0005518646, 0.000512429,
        0.0004760213, 0.0004424536, 0.0004115117, 0.0003829814, 0.0003566491,
        0.0003323011, 0.0003097586, 0.0002888871, 0.0002695394, 0.0002515682,
        0.0002348261, 0.000219171, 0.0002045258, 0.0001908405, 0.0001780654,
        0.0001661505, 0.0001550236, 0.0001446219, 0.0001349098, 0.000125852,
        0.000117413, 0.0001095515, 0.0001022245, 0.00009539445, 0.0000890239,
        0.00008307527, 0.00007751269, 0.00007231304, 0.00006745778, 0.00006292844,
        0.00005870652, 0.00005477028, 0.00005109918, 0.00004767654, 0.00004448567,
        0.00004150994, 0.00003873324, 0.00003614203, 0.00003372352, 0.00003146487,
        0.00002935326, 0.00002737573, 0.00002552433, 0.00002379376, 0.0000221787,
        0.00002067383, 0.00001927226, 0.0000179664, 0.00001674991, 0.00001561648,
        0.00001455977, 0.00001357387, 0.00001265436, 0.00001179723, 0.00001099844,
        0.00001025398, 0.000009559646, 0.000008912044, 0.000008308358, 0.000007745769,
        0.000007221456, 0.000006732475, 0.000006276423, 0.000005851304, 0.000005455118,
        0.000005085868, 0.000004741466, 0.000004420236, 0.000004120783, 0.000003841716,
        0.000003581652, 0.000003339127, 0.000003112949, 0.000002902121, 0.000002705645,
        0.000002522525, 0.000002351726, 0.000002192415, 0.000002043902, 0.000001905497,
        0.000001776509, 0.000001656215, 0.000001544022, 0.00000143944, 0.000001341977,
        0.000001251141];
    private static readonly double[] Cie1931YData = [
        0.000003917, 0.000004393581, 0.000004929604, 0.000005532136, 0.000006208245,
        0.000006965, 0.000007813219, 0.000008767336, 0.000009839844, 0.00001104323,
        0.00001239, 0.00001388641, 0.00001555728, 0.00001744296, 0.00001958375,
        0.00002202, 0.00002483965, 0.00002804126, 0.00003153104, 0.00003521521,
        0.000039, 0.0000428264, 0.0000469146, 0.0000515896, 0.0000571764,
        0.000064, 0.00007234421, 0.00008221224, 0.00009350816, 0.0001061361,
        0.00012, 0.000134984, 0.000151492, 0.000170208, 0.000191816,
        0.000217, 0.0002469067, 0.00028124, 0.00031852, 0.0003572667,
        0.000396, 0.0004337147, 0.000473024, 0.000517876, 0.0005722187,
        0.00064, 0.00072456, 0.0008255, 0.00094116, 0.00106988,
        0.00121, 0.001362091, 0.001530752, 0.001720368, 0.001935323,
        0.00218, 0.0024548, 0.002764, 0.0031178, 0.0035264,
        0.004, 0.00454624, 0.00515932, 0.00582928, 0.00654616,
        0.0073, 0.008086507, 0.00890872, 0.00976768, 0.01066443,
        0.0116, 0.01257317, 0.01358272, 0.01462968, 0.01571509,
        0.01684, 0.01800736, 0.01921448, 0.02045392, 0.02171824,
        0.023, 0.02429461, 0.02561024, 0.02695857, 0.02835125,
        0.0298, 0.03131083, 0.03288368, 0.03452112, 0.03622571,
        0.038, 0.03984667, 0.041768, 0.043766, 0.04584267,
        0.048, 0.05024368, 0.05257304, 0.05498056, 0.05745872,
        0.06, 0.06260197, 0.06527752, 0.06804208, 0.07091109,
        0.0739, 0.077016, 0.0802664, 0.0836668, 0.0872328,
        0.09098, 0.09491755, 0.09904584, 0.1033674, 0.1078846,
        0.1126, 0.117532, 0.1226744, 0.1279928, 0.1334528,
        0.13902, 0.1446764, 0.1504693, 0.1564619, 0.1627177,
        0.1693, 0.1762431, 0.1835581, 0.1912735, 0.199418,
        0.20802, 0.2171199, 0.2267345, 0.2368571, 0.2474812,
        0.2586, 0.2701849, 0.2822939, 0.2950505, 0.308578,
        0.323, 0.3384021, 0.3546858, 0.3716986, 0.3892875,
        0.4073, 0.4256299, 0.4443096, 0.4633944, 0.4829395,
        0.503, 0.5235693, 0.544512, 0.56569, 0.5869653,
        0.6082, 0.6293456, 0.6503068, 0.6708752, 0.6908424,
        0.71, 0.7281852, 0.7454636, 0.7619694, 0.7778368,
        0.7932, 0.8081104, 0.8224962, 0.8363068, 0.8494916,
        0.862, 0.8738108, 0.8849624, 0.8954936, 0.9054432,
        0.9148501, 0.9237348, 0.9320924, 0.9399226, 0.9472252,
        0.954, 0.9602561, 0.9660074, 0.9712606, 0.9760225,
        0.9803, 0.9840924, 0.9874182, 0.9903128, 0.9928116,
        0.9949501, 0.9967108, 0.9980983, 0.999112, 0.9997482,
        1, 0.9998567, 0.9993046, 0.9983255, 0.9968987,
        0.995, 0.9926005, 0.9897426, 0.9864444, 0.9827241,
        0.9786, 0.9740837, 0.9691712, 0.9638568, 0.9581349,
        0.952, 0.9454504, 0.9384992, 0.9311628, 0.9234576,
        0.9154, 0.9070064, 0.8982772, 0.8892048, 0.8797816,
        0.87, 0.8598613, 0.849392, 0.838622, 0.8275813,
        0.8163, 0.8047947, 0.793082, 0.781192, 0.7691547,
        0.757, 0.7447541, 0.7324224, 0.7200036, 0.7074965,
        0.6949, 0.6822192, 0.6694716, 0.6566744, 0.6438448,
        0.631, 0.6181555, 0.6053144, 0.5924756, 0.5796379,
        0.5668, 0.5539611, 0.5411372, 0.5283528, 0.5156323,
        0.503, 0.4904688, 0.4780304, 0.4656776, 0.4534032,
        0.4412, 0.42908, 0.417036, 0.405032, 0.393032,
        0.381, 0.3689184, 0.3568272, 0.3447768, 0.3328176,
        0.321, 0.3093381, 0.2978504, 0.2865936, 0.2756245,
        0.265, 0.2547632, 0.2448896, 0.2353344, 0.2260528,
        0.217, 0.2081616, 0.1995488, 0.1911552, 0.1829744,
        0.175, 0.1672235, 0.1596464, 0.1522776, 0.1451259,
        0.1382, 0.1315003, 0.1250248, 0.1187792, 0.1127691,
        0.107, 0.1014762, 0.09618864, 0.09112296, 0.08626485,
        0.0816, 0.07712064, 0.07282552, 0.06871008, 0.06476976,
        0.061, 0.05739621, 0.05395504, 0.05067376, 0.04754965,
        0.04458, 0.04175872, 0.03908496, 0.03656384, 0.03420048,
        0.032, 0.02996261, 0.02807664, 0.02632936, 0.02470805,
        0.0232, 0.02180077, 0.02050112, 0.01928108, 0.01812069,
        0.017, 0.01590379, 0.01483718, 0.01381068, 0.01283478,
        0.01192, 0.01106831, 0.01027339, 0.009533311, 0.008846157,
        0.00821, 0.007623781, 0.007085424, 0.006591476, 0.006138485,
        0.005723, 0.005343059, 0.004995796, 0.004676404, 0.004380075,
        0.004102, 0.003838453, 0.003589099, 0.003354219, 0.003134093,
        0.002929, 0.002738139, 0.002559876, 0.002393244, 0.002237275,
        0.002091, 0.001953587, 0.00182458, 0.00170358, 0.001590187,
        0.001484, 0.001384496, 0.001291268, 0.001204092, 0.001122744,
        0.001047, 0.0009765896, 0.0009111088, 0.0008501332, 0.0007932384,
        0.00074, 0.0006900827, 0.00064331, 0.000599496, 0.0005584547,
        0.00052, 0.0004839136, 0.0004500528, 0.0004183452, 0.0003887184,
        0.0003611, 0.0003353835, 0.0003114404, 0.0002891656, 0.0002684539,
        0.0002492, 0.0002313019, 0.0002146856, 0.0001992884, 0.0001850475,
        0.0001719, 0.0001597781, 0.0001486044, 0.0001383016, 0.0001287925,
        0.00012, 0.0001118595, 0.0001043224, 0.0000973356, 0.00009084587,
        0.0000848, 0.00007914667, 0.000073858, 0.000068916, 0.00006430267,
        0.00006, 0.00005598187, 0.0000522256, 0.0000487184, 0.00004544747,
        0.0000424, 0.00003956104, 0.00003691512, 0.00003444868, 0.00003214816,
        0.00003, 0.00002799125, 0.00002611356, 0.00002436024, 0.00002272461,
        0.0000212, 0.00001977855, 0.00001845285, 0.00001721687, 0.00001606459,
        0.00001499, 0.00001398728, 0.00001305155, 0.00001217818, 0.00001136254,
        0.0000106, 0.000009885877, 0.000009217304, 0.000008592362, 0.000008009133,
        0.0000074657, 0.000006959567, 0.000006487995, 0.000006048699, 0.000005639396,
        0.0000052578, 0.000004901771, 0.00000456972, 0.000004260194, 0.000003971739,
        0.0000037029, 0.000003452163, 0.000003218302, 0.0000030003, 0.000002797139,
        0.0000026078, 0.00000243122, 0.000002266531, 0.000002113013, 0.000001969943,
        0.0000018366, 0.00000171223, 0.000001596228, 0.00000148809, 0.000001387314,
        0.0000012934, 0.00000120582, 0.000001124143, 0.000001048009, 0.0000009770578,
        0.00000091093, 0.0000008492513, 0.0000007917212, 0.0000007380904, 0.0000006881098,
        0.00000064153, 0.0000005980895, 0.0000005575746, 0.000000519808, 0.0000004846123,
        0.00000045181];
    private static readonly double[] Cie1931ZData = [
        0.0006061, 0.0006808792, 0.0007651456, 0.0008600124, 0.0009665928,
        0.001086, 0.001220586, 0.001372729, 0.001543579, 0.001734286,
        0.001946, 0.002177777, 0.002435809, 0.002731953, 0.003078064,
        0.003486, 0.003975227, 0.00454088, 0.00515832, 0.005802907,
        0.006450001, 0.007083216, 0.007745488, 0.008501152, 0.009414544,
        0.01054999, 0.0119658, 0.01365587, 0.01558805, 0.01773015,
        0.02005001, 0.02251136, 0.02520288, 0.02827972, 0.03189704,
        0.03621, 0.04143771, 0.04750372, 0.05411988, 0.06099803,
        0.06785001, 0.07448632, 0.08136156, 0.08915364, 0.09854048,
        0.1102, 0.1246133, 0.1417017, 0.1613035, 0.1832568,
        0.2074, 0.2336921, 0.2626114, 0.2947746, 0.3307985,
        0.3713, 0.4162091, 0.4654642, 0.5196948, 0.5795303,
        0.6456, 0.7184838, 0.7967133, 0.8778459, 0.959439,
        1.0390501, 1.1153673, 1.1884971, 1.2581233, 1.3239296,
        1.3856, 1.4426352, 1.4948035, 1.5421903, 1.5848807,
        1.62296, 1.6564048, 1.6852959, 1.7098745, 1.7303821,
        1.74706, 1.7600446, 1.7696233, 1.7762637, 1.7804334,
        1.7826, 1.7829682, 1.7816998, 1.7791982, 1.7758671,
        1.77211, 1.7682589, 1.764039, 1.7589438, 1.7524663,
        1.7441, 1.7335595, 1.7208581, 1.7059369, 1.6887372,
        1.6692, 1.6475287, 1.6234127, 1.5960223, 1.564528,
        1.5281, 1.4861114, 1.4395215, 1.3898799, 1.3387362,
        1.28764, 1.2374223, 1.1878243, 1.1387611, 1.090148,
        1.0419, 0.9941976, 0.9473473, 0.9014531, 0.8566193,
        0.8129501, 0.7705173, 0.7294448, 0.6899136, 0.6521049,
        0.6162, 0.5823286, 0.5504162, 0.5203376, 0.4919673,
        0.46518, 0.4399246, 0.4161836, 0.3938822, 0.3729459,
        0.3533, 0.3348578, 0.3175521, 0.3013375, 0.2861686,
        0.272, 0.2588171, 0.2464838, 0.2347718, 0.2234533,
        0.2123, 0.2011692, 0.1901196, 0.1792254, 0.1685608,
        0.1582, 0.1481383, 0.1383758, 0.1289942, 0.1200751,
        0.1117, 0.1039048, 0.09666748, 0.08998272, 0.08384531,
        0.07824999, 0.07320899, 0.06867816, 0.06456784, 0.06078835,
        0.05725001, 0.05390435, 0.05074664, 0.04775276, 0.04489859,
        0.04216, 0.03950728, 0.03693564, 0.03445836, 0.03208872,
        0.02984, 0.02771181, 0.02569444, 0.02378716, 0.02198925,
        0.0203, 0.01871805, 0.01724036, 0.01586364, 0.01458461,
        0.0134, 0.01230723, 0.01130188, 0.01037792, 0.009529306,
        0.008749999, 0.0080352, 0.0073816, 0.0067854, 0.0062428,
        0.005749999, 0.0053036, 0.0048998, 0.0045342, 0.0042024,
        0.0039, 0.0036232, 0.0033706, 0.0031414, 0.0029348,
        0.002749999, 0.0025852, 0.0024386, 0.0023094, 0.0021968,
        0.0021, 0.002017733, 0.0019482, 0.0018898, 0.001840933,
        0.0018, 0.001766267, 0.0017378, 0.0017112, 0.001683067,
        0.001650001, 0.001610133, 0.0015644, 0.0015136, 0.001458533,
        0.0014, 0.001336667, 0.00127, 0.001205, 0.001146667,
        0.0011, 0.0010688, 0.0010494, 0.0010356, 0.0010212,
        0.001, 0.00096864, 0.00092992, 0.00088688, 0.00084256,
        0.0008, 0.00076096, 0.00072368, 0.00068592, 0.00064544,
        0.0006, 0.0005478667, 0.0004916, 0.0004354, 0.0003834667,
        0.00034, 0.0003072533, 0.00028316, 0.00026544, 0.0002518133,
        0.00024, 0.0002295467, 0.00022064, 0.00021196, 0.0002021867,
        0.00019, 0.0001742133, 0.00015564, 0.00013596, 0.0001168533,
        0.0001, 0.00008613333, 0.0000746, 0.000065, 0.00005693333,
        0.00004999999, 0.00004416, 0.00003948, 0.00003572, 0.00003264,
        0.00003, 0.00002765333, 0.00002556, 0.00002364, 0.00002181333,
        0.00002, 0.00001813333, 0.0000162, 0.0000142, 0.00001213333,
        0.00001, 0.000007733333, 0.0000054, 0.0000032, 0.000001333333,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0];
    public static readonly DenselySampledSpectrum Cie1931X;
    public static readonly DenselySampledSpectrum Cie1931Y;
    public static readonly DenselySampledSpectrum Cie1931Z;

    // https://cie.co.at/datatable/cie-standard-illuminant-d65
    private static readonly SpectraData[] CieIllumD65Data = [
        new(300, 0.0341), new(301, 0.36014), new(302, 0.68618), new(303, 1.01222), new(304, 1.33826), new(305, 1.6643), new(306, 1.99034), new(307, 2.31638),
        new(308, 2.64242), new(309, 2.96846), new(310, 3.2945), new(311, 4.98865), new(312, 6.6828), new(313, 8.37695), new(314, 10.0711), new(315, 11.7652),
        new(316, 13.4594), new(317, 15.1535), new(318, 16.8477), new(319, 18.5418), new(320, 20.236), new(321, 21.9177), new(322, 23.5995), new(323, 25.2812),
        new(324, 26.963), new(325, 28.6447), new(326, 30.3265), new(327, 32.0082), new(328, 33.69), new(329, 35.3717), new(330, 37.0535), new(331, 37.343),
        new(332, 37.6326), new(333, 37.9221), new(334, 38.2116), new(335, 38.5011), new(336, 38.7907), new(337, 39.0802), new(338, 39.3697), new(339, 39.6593),
        new(340, 39.9488), new(341, 40.4451), new(342, 40.9414), new(343, 41.4377), new(344, 41.934), new(345, 42.4302), new(346, 42.9265), new(347, 43.4228),
        new(348, 43.9191), new(349, 44.4154), new(350, 44.9117), new(351, 45.0844), new(352, 45.257), new(353, 45.4297), new(354, 45.6023), new(355, 45.775),
        new(356, 45.9477), new(357, 46.1203), new(358, 46.293), new(359, 46.4656), new(360, 46.6383), new(361, 47.1834), new(362, 47.7285), new(363, 48.2735),
        new(364, 48.8186), new(365, 49.3637), new(366, 49.9088), new(367, 50.4539), new(368, 50.9989), new(369, 51.544), new(370, 52.0891), new(371, 51.8777),
        new(372, 51.6664), new(373, 51.455), new(374, 51.2437), new(375, 51.0323), new(376, 50.8209), new(377, 50.6096), new(378, 50.3982), new(379, 50.1869),
        new(380, 49.9755), new(381, 50.4428), new(382, 50.91), new(383, 51.3773), new(384, 51.8446), new(385, 52.3118), new(386, 52.7791), new(387, 53.2464),
        new(388, 53.7137), new(389, 54.1809), new(390, 54.6482), new(391, 57.4589), new(392, 60.2695), new(393, 63.0802), new(394, 65.8909), new(395, 68.7015),
        new(396, 71.5122), new(397, 74.3229), new(398, 77.1336), new(399, 79.9442), new(400, 82.7549), new(401, 83.628), new(402, 84.5011), new(403, 85.3742),
        new(404, 86.2473), new(405, 87.1204), new(406, 87.9936), new(407, 88.8667), new(408, 89.7398), new(409, 90.6129), new(410, 91.486), new(411, 91.6806),
        new(412, 91.8752), new(413, 92.0697), new(414, 92.2643), new(415, 92.4589), new(416, 92.6535), new(417, 92.8481), new(418, 93.0426), new(419, 93.2372),
        new(420, 93.4318), new(421, 92.7568), new(422, 92.0819), new(423, 91.4069), new(424, 90.732), new(425, 90.057), new(426, 89.3821), new(427, 88.7071),
        new(428, 88.0322), new(429, 87.3572), new(430, 86.6823), new(431, 88.5006), new(432, 90.3188), new(433, 92.1371), new(434, 93.9554), new(435, 95.7736),
        new(436, 97.5919), new(437, 99.4102), new(438, 101.228), new(439, 103.047), new(440, 104.865), new(441, 106.079), new(442, 107.294), new(443, 108.508),
        new(444, 109.722), new(445, 110.936), new(446, 112.151), new(447, 113.365), new(448, 114.579), new(449, 115.794), new(450, 117.008), new(451, 117.088),
        new(452, 117.169), new(453, 117.249), new(454, 117.33), new(455, 117.41), new(456, 117.49), new(457, 117.571), new(458, 117.651), new(459, 117.732),
        new(460, 117.812), new(461, 117.517), new(462, 117.222), new(463, 116.927), new(464, 116.632), new(465, 116.336), new(466, 116.041), new(467, 115.746),
        new(468, 115.451), new(469, 115.156), new(470, 114.861), new(471, 114.967), new(472, 115.073), new(473, 115.18), new(474, 115.286), new(475, 115.392),
        new(476, 115.498), new(477, 115.604), new(478, 115.711), new(479, 115.817), new(480, 115.923), new(481, 115.212), new(482, 114.501), new(483, 113.789),
        new(484, 113.078), new(485, 112.367), new(486, 111.656), new(487, 110.945), new(488, 110.233), new(489, 109.522), new(490, 108.811), new(491, 108.865),
        new(492, 108.92), new(493, 108.974), new(494, 109.028), new(495, 109.082), new(496, 109.137), new(497, 109.191), new(498, 109.245), new(499, 109.3),
        new(500, 109.354), new(501, 109.199), new(502, 109.044), new(503, 108.888), new(504, 108.733), new(505, 108.578), new(506, 108.423), new(507, 108.268),
        new(508, 108.112), new(509, 107.957), new(510, 107.802), new(511, 107.501), new(512, 107.2), new(513, 106.898), new(514, 106.597), new(515, 106.296),
        new(516, 105.995), new(517, 105.694), new(518, 105.392), new(519, 105.091), new(520, 104.79), new(521, 105.08), new(522, 105.37), new(523, 105.66),
        new(524, 105.95), new(525, 106.239), new(526, 106.529), new(527, 106.819), new(528, 107.109), new(529, 107.399), new(530, 107.689), new(531, 107.361),
        new(532, 107.032), new(533, 106.704), new(534, 106.375), new(535, 106.047), new(536, 105.719), new(537, 105.39), new(538, 105.062), new(539, 104.733),
        new(540, 104.405), new(541, 104.369), new(542, 104.333), new(543, 104.297), new(544, 104.261), new(545, 104.225), new(546, 104.19), new(547, 104.154),
        new(548, 104.118), new(549, 104.082), new(550, 104.046), new(551, 103.641), new(552, 103.237), new(553, 102.832), new(554, 102.428), new(555, 102.023),
        new(556, 101.618), new(557, 101.214), new(558, 100.809), new(559, 100.405), new(560, 100), new(561, 99.6334), new(562, 99.2668), new(563, 98.9003),
        new(564, 98.5337), new(565, 98.1671), new(566, 97.8005), new(567, 97.4339), new(568, 97.0674), new(569, 96.7008), new(570, 96.3342), new(571, 96.2796),
        new(572, 96.225), new(573, 96.1703), new(574, 96.1157), new(575, 96.0611), new(576, 96.0065), new(577, 95.9519), new(578, 95.8972), new(579, 95.8426),
        new(580, 95.788), new(581, 95.0778), new(582, 94.3675), new(583, 93.6573), new(584, 92.947), new(585, 92.2368), new(586, 91.5266), new(587, 90.8163),
        new(588, 90.1061), new(589, 89.3958), new(590, 88.6856), new(591, 88.8177), new(592, 88.9497), new(593, 89.0818), new(594, 89.2138), new(595, 89.3459),
        new(596, 89.478), new(597, 89.61), new(598, 89.7421), new(599, 89.8741), new(600, 90.0062), new(601, 89.9655), new(602, 89.9248), new(603, 89.8841),
        new(604, 89.8434), new(605, 89.8026), new(606, 89.7619), new(607, 89.7212), new(608, 89.6805), new(609, 89.6398), new(610, 89.5991), new(611, 89.4091),
        new(612, 89.219), new(613, 89.029), new(614, 88.8389), new(615, 88.6489), new(616, 88.4589), new(617, 88.2688), new(618, 88.0788), new(619, 87.8887),
        new(620, 87.6987), new(621, 87.2577), new(622, 86.8167), new(623, 86.3757), new(624, 85.9347), new(625, 85.4936), new(626, 85.0526), new(627, 84.6116),
        new(628, 84.1706), new(629, 83.7296), new(630, 83.2886), new(631, 83.3297), new(632, 83.3707), new(633, 83.4118), new(634, 83.4528), new(635, 83.4939),
        new(636, 83.535), new(637, 83.576), new(638, 83.6171), new(639, 83.6581), new(640, 83.6992), new(641, 83.332), new(642, 82.9647), new(643, 82.5975),
        new(644, 82.2302), new(645, 81.863), new(646, 81.4958), new(647, 81.1285), new(648, 80.7613), new(649, 80.394), new(650, 80.0268), new(651, 80.0456),
        new(652, 80.0644), new(653, 80.0831), new(654, 80.1019), new(655, 80.1207), new(656, 80.1395), new(657, 80.1583), new(658, 80.177), new(659, 80.1958),
        new(660, 80.2146), new(661, 80.4209), new(662, 80.6272), new(663, 80.8336), new(664, 81.0399), new(665, 81.2462), new(666, 81.4525), new(667, 81.6588),
        new(668, 81.8652), new(669, 82.0715), new(670, 82.2778), new(671, 81.8784), new(672, 81.4791), new(673, 81.0797), new(674, 80.6804), new(675, 80.281),
        new(676, 79.8816), new(677, 79.4823), new(678, 79.0829), new(679, 78.6836), new(680, 78.2842), new(681, 77.4279), new(682, 76.5716), new(683, 75.7153),
        new(684, 74.859), new(685, 74.0027), new(686, 73.1465), new(687, 72.2902), new(688, 71.4339), new(689, 70.5776), new(690, 69.7213), new(691, 69.9101),
        new(692, 70.0989), new(693, 70.2876), new(694, 70.4764), new(695, 70.6652), new(696, 70.854), new(697, 71.0428), new(698, 71.2315), new(699, 71.4203),
        new(700, 71.6091), new(701, 71.8831), new(702, 72.1571), new(703, 72.4311), new(704, 72.7051), new(705, 72.979), new(706, 73.253), new(707, 73.527),
        new(708, 73.801), new(709, 74.075), new(710, 74.349), new(711, 73.0745), new(712, 71.8), new(713, 70.5255), new(714, 69.251), new(715, 67.9765),
        new(716, 66.702), new(717, 65.4275), new(718, 64.153), new(719, 62.8785), new(720, 61.604), new(721, 62.4322), new(722, 63.2603), new(723, 64.0885),
        new(724, 64.9166), new(725, 65.7448), new(726, 66.573), new(727, 67.4011), new(728, 68.2293), new(729, 69.0574), new(730, 69.8856), new(731, 70.4057),
        new(732, 70.9259), new(733, 71.446), new(734, 71.9662), new(735, 72.4863), new(736, 73.0064), new(737, 73.5266), new(738, 74.0467), new(739, 74.5669),
        new(740, 75.087), new(741, 73.9376), new(742, 72.7881), new(743, 71.6387), new(744, 70.4893), new(745, 69.3398), new(746, 68.1904), new(747, 67.041),
        new(748, 65.8916), new(749, 64.7421), new(750, 63.5927), new(751, 61.8752), new(752, 60.1578), new(753, 58.4403), new(754, 56.7229), new(755, 55.0054),
        new(756, 53.288), new(757, 51.5705), new(758, 49.8531), new(759, 48.1356), new(760, 46.4182), new(761, 48.4569), new(762, 50.4956), new(763, 52.5344),
        new(764, 54.5731), new(765, 56.6118), new(766, 58.6505), new(767, 60.6892), new(768, 62.728), new(769, 64.7667), new(770, 66.8054), new(771, 66.4631),
        new(772, 66.1209), new(773, 65.7786), new(774, 65.4364), new(775, 65.0941), new(776, 64.7518), new(777, 64.4096), new(778, 64.0673), new(779, 63.7251),
        new(780, 63.3828), new(781, 63.4749), new(782, 63.567), new(783, 63.6592), new(784, 63.7513), new(785, 63.8434), new(786, 63.9355), new(787, 64.0276),
        new(788, 64.1198), new(789, 64.2119), new(790, 64.304), new(791, 63.8188), new(792, 63.3336), new(793, 62.8484), new(794, 62.3632), new(795, 61.8779),
        new(796, 61.3927), new(797, 60.9075), new(798, 60.4223), new(799, 59.9371), new(800, 59.4519), new(801, 58.7026), new(802, 57.9533), new(803, 57.204),
        new(804, 56.4547), new(805, 55.7054), new(806, 54.9562), new(807, 54.2069), new(808, 53.4576), new(809, 52.7083), new(810, 51.959), new(811, 52.5072),
        new(812, 53.0553), new(813, 53.6035), new(814, 54.1516), new(815, 54.6998), new(816, 55.248), new(817, 55.7961), new(818, 56.3443), new(819, 56.8924),
        new(820, 57.4406), new(821, 57.7278), new(822, 58.015), new(823, 58.3022), new(824, 58.5894), new(825, 58.8765), new(826, 59.1637), new(827, 59.4509),
        new(828, 59.7381), new(829, 60.0253), new(830, 60.3125)];
    public static readonly PiecewiseLinearSpectrum CieIllumD65;

    static Spectra()
    {
        {
            double resultY = 0;
            for (int i = 1; i < Cie1931YData.Length; i++)
            {
                resultY += (Cie1931YData[i - 1] + Cie1931YData[i]) / 2.0;
            }
            Cie1931IntegralY = resultY;
        }
        {
            Cie1931X = new DenselySampledSpectrum(new PiecewiseLinearSpectrum(Cie1931XData, Cie1931XyzLambdas, false), LambdaMin, LambdaMax);
            Cie1931Y = new DenselySampledSpectrum(new PiecewiseLinearSpectrum(Cie1931YData, Cie1931XyzLambdas, false), LambdaMin, LambdaMax);
            Cie1931Z = new DenselySampledSpectrum(new PiecewiseLinearSpectrum(Cie1931ZData, Cie1931XyzLambdas, false), LambdaMin, LambdaMax);
        }
        {
            CieIllumD65 = new PiecewiseLinearSpectrum(CieIllumD65Data, true);
        }
    }
}
